<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.hospital.erp.member.MemberDAO">
 	
 	<!-- 직원 리스트 조회 쿼리 -->
	<select id="memberList" resultMap="memberListJoin">
		SELECT 
			M.MEM_CD,
			M.MEM_NAME,
			D.DEP_NAME,
			C.CODE_NAME,
			M.MEM_HDATE,
			M.MEM_ANNUAL
		FROM 
			MEMBER AS M
				LEFT OUTER JOIN CODE AS C
					ON M.JOB_CD = C.CODE_CD
				LEFT OUTER JOIN COMMUTE AS COM
					ON M.MEM_CD = COM.MEM_CD
				LEFT OUTER JOIN	DEPARTMENT D
					ON M.DEP_CD = D.DEP_CD
	</select> 	
	
	<resultMap type="MemberVO" id="memberListJoin">
		<id column="MEM_CD" property="memCd"/>
		<result column="MEM_NAME" property="memName"/>
		<result column="MEM_HDATE" property="memHdate"/>
		<result column="MEM_ANNUAL" property="memAnnual"/>
		<result column="CODE_NAME" property="codeName"/>
		<association property="departmentVO" javaType="DepartmentVO">
			<result column="DEP_NAME" property="depName"/>
		</association>	
	</resultMap>
  	
  	<!-- 직원 상세 조회 쿼리 -->
  	<select id="memberData" parameterType="MemberVO" resultType="MemberVO">
		SELECT
			*
		FROM
			MEMBER
		WHERE
			MEM_CD = #{memCd}  	
  	</select>
  	
  	<!-- Member 테이블 Insert 전 사번 입력을위해 가장 마지막 사번 조회해오는 쿼리문 -->
  	<select id="memberDataMaxMemCd" resultType="MemberVO" parameterType="MemberVO">
  		SELECT 
  			*
		FROM 
			MEMBER
		WHERE 
			MEM_CD IN
					(SELECT 
						MAX(MEM_CD)
					FROM 
						MEMBER
					GROUP BY 
						JOB_CD 
					HAVING 
						JOB_CD = #{jobCd} AND 
						MEM_HDATE > #{memHdate}
					)
			   
  	</select>
  	
  	<!-- MEMBER 테이블 INSERT 쿼리 -->
  	<insert id="memberInsert" parameterType="MemberVO">
  		INSERT INTO
  			MEMBER
  		VALUES
  			(
  			#{memCd},
  			#{jobCd},
  			1,
  			3,
  			#{codeCd},
  			#{memName},
  			#{memRnum},
  			#{memPw},
  			#{memPnum},
  			#{memAddress},
  			#{memEmail},
  			#{memHdate},
  			#{memSalary},
  			15,
  			NULL,
  			0,
  			NOW()
  			)
  			
  	</insert>
  	
</mapper>